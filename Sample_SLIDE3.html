<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>DUYSlidesAI - Mẫu soạn bài tương tác</title>

  <!-- Font Awesome 5.15.4 -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

  <!--
    ==================================================================
    HƯỚNG DẪN VIẾT CÔNG THỨC TOÁN
    Để công thức trong dòng (inline) hiển thị đẹp đúng chuẩn LaTeX
    (ví dụ: phân số, tổng sigma), hãy luôn thêm `\displaystyle`
    vào ngay sau ký tự `$` mở đầu.

    VÍ DỤ:
    - CHUẨN:   $\displaystyle \frac{a+b}{c}$ hoặc $\displaystyle \sum_{i=1}^{n} i$
    - KHÔNG CHUẨN: $\frac{a+b}{c}$ hoặc $\sum_{i=1}^{n} i$
    ==================================================================
  -->
  <script>
    MathJax = {
      tex: {
        inlineMath: [["$","$"],["\\(","\\)"]],
        displayMath: [["$$","$$"],["\\[","\\]"]]
      },
      svg: { fontCache: 'global' }
    };
  </script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>

  <style>
    :root {
      --color-memo: #16a085; --bg-memo: #f0fdfa;
      --color-activity: #d35400; --bg-activity: #fff8f2;
      --color-example: #2980b9; --bg-example: #f2f9ff;
      --color-exercise: #8e44ad; --bg-exercise: #fbf5ff;
      --color-proof: #0077b6; --bg-proof: #f2fbff;
      --color-note: #c29304; --bg-note: #fffcf2;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; line-height: 1.7; background-color: #f0f2f5; color: #3a3a3a; padding: 20px; }
    .container { max-width: 980px; margin: 0 auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
    .header { text-align: center; margin-bottom: 30px; border-bottom: 1px solid #eee; padding-bottom: 20px; }
    .header h1 { font-size: 2.2rem; color: #1a5276; margin-bottom: 8px; }
    .header .author { font-size: 1.05rem; color: #555; font-style: italic; }

    .box { position: relative; padding: 16px; padding-top: 25px; padding-bottom: 35px; padding-right: 25px; margin: 20px 0; border: 1px solid #e0e0e0; border-left-width: 5px; border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.05); }
    .box-title { font-size: 1.16rem; font-weight: 700; margin-bottom: 12px; display: flex; align-items: center; }
    .box-title .fas { margin-right: 10px; font-size: 1.05em; }
    ul, ol { padding-left: 25px; }

    .trigger-bar { height: 10px; width: 100%; cursor: pointer; opacity: 0.85; transition: opacity 0.2s; }
    .trigger-bar:hover { opacity: 1; }
    .trigger-top { position: absolute; top: 0; left: 0; width: calc(100% - 10px); border-top-left-radius: 8px; overflow: hidden; }
    .trigger-image-link { background: linear-gradient(90deg, #9b59b6, #3498db, #1abc9c); }
    .trigger-right { position: absolute; top: 0; right: 0; width: 10px; height: 100%; background: linear-gradient(180deg, #00c6ff, #0072ff); cursor: pointer; opacity: 0.85; transition: opacity 0.2s; border-top-right-radius: 8px; border-bottom-right-radius: 8px; }
    .trigger-right:hover { opacity: 1; }
    .triggers-bottom { position: absolute; bottom: 0; left: 0; width: calc(100% - 10px); border-bottom-left-radius: 8px; overflow: hidden; }
    .trigger-audio { background: linear-gradient(90deg, #f1c40f, #e67e22, #d35400); }
    .trigger-image-file { background: linear-gradient(90deg, #3498db, #2ecc71, #e74c3c, #f39c12); }

    .media-content-area { background: rgba(249, 249, 249, 0.7); border: 1px solid #eee; border-radius: 8px; padding: 15px; margin-top: 18px; }
    .image-placeholder { display: flex; justify-content: center; align-items: center; min-height: 120px; border: 2px dashed #ccc; border-radius: 8px; color: #888; text-align: center; padding: 10px; font-size: 0.9em; }
    .image-preview { max-width: 100%; max-height: 300px; display: none; margin: 0 auto; border-radius: 8px; }
    .audio-container { margin-top: 15px; min-height: 25px; }
    .embed-app-container { display: none; margin-top: 15px; }
    .embed-app-container iframe { width: 100%; height: 450px; border: 1px solid #ddd; border-radius: 8px; }

    .custom-audio-player { display: none; height: 24px; width: 100%; background: linear-gradient(90deg, #8e44ad, #3498db, #16a085); border-radius: 12px; cursor: pointer; padding: 0 15px; align-items: center; opacity: 0.9; }
    .play-pause-btn { width: 0; height: 0; border-style: solid; border-width: 7px 0 7px 12px; border-color: transparent transparent transparent #fff; }
    .play-pause-btn.playing { border-style: double; border-width: 0 0 0 10px; height: 14px; border-color: #fff; }
    .embed-audio-container { display: none; }
    .embed-audio-container iframe { border: none; border-radius: 8px; width: 100%; }
    audio, .file-input { display: none; }

    .memo-box { background-color: var(--bg-memo); border-left-color: var(--color-memo); } .memo-box .box-title { color: var(--color-memo); }
    .activity-box { background-color: var(--bg-activity); border-left-color: var(--color-activity); } .activity-box .box-title { color: var(--color-activity); }
    .example-box { background-color: var(--bg-example); border-left-color: var(--color-example); } .example-box .box-title { color: var(--color-example); }
    .exercise-box { background-color: var(--bg-exercise); border-left-color: var(--color-exercise); } .exercise-box .box-title { color: var(--color-exercise); }
    .proof-box { background-color: var(--bg-proof); border-left-color: var(--color-proof); } .proof-box .box-title { color: var(--color-proof); }
    .note-box { background-color: var(--bg-note); border-left-color: var(--color-note); } .note-box .box-title { color: var(--color-note); }

    .section-container h2 { font-size: 1.6rem; color: #2874a6; margin: 34px 0 12px; padding-bottom: 6px; border-bottom: 2px solid #3498db; }
    .math-term strong { color: #c0392b; }
    .math-term em { color: #7f8c8d; }
  </style>
</head>
<body>

<div class="container">
  <div class="header">
    <h1>Công thức xác suất toàn phần — từ trộn dung dịch đến xác suất</h1>
    <p class="author">Duymt2 Đại học Mai Duy Khánh Linh</p>
  </div>

  <div class="section-container"><h2>PHẦN 1: MỞ ĐẦU & KHÁM PHÁ</h2></div>

  <div class="box memo-box" data-id="goals">
    <div class="trigger-top"><div class="trigger-bar trigger-image-link" onclick="promptImageUrl(this)" title="Nhập link ảnh"></div></div>
    <div class="trigger-right" onclick="promptAppUrl(this)" title="Nhúng ứng dụng/web"></div>
    <div class="box-title"><i class="fas fa-lightbulb"></i> Mục tiêu bài học</div>
    <ul>
      <li>Phân biệt tư duy <span class="math-term"><strong>tĩnh</strong></span> và <span class="math-term"><strong>động</strong></span> qua tình huống trộn dung dịch.</li>
      <li>Hiểu <span class="math-term"><strong>trung bình có trọng số</strong></span> và vai trò của <em>trọng số</em>.</li>
      <li>Tự xây dựng <span class="math-term"><strong>công thức xác suất toàn phần</strong></span> từ mô hình thực tế.</li>
    </ul>
    <div class="media-content-area">
      <img class="image-preview" alt="Xem trước"><div class="image-placeholder">Chưa có media trực quan...</div>
      <div class="embed-app-container"></div>
      <div class="audio-container"><div class="custom-audio-player"><div class="play-pause-btn"></div></div><div class="embed-audio-container"></div><audio></audio></div>
    </div>
    <div class="triggers-bottom"><div class="trigger-bar trigger-audio" onclick="promptAudio(this)" title="Nhập âm thanh (mp3) hoặc mã nhúng"></div><div class="trigger-bar trigger-image-file" onclick="triggerFileInput(this)" title="Tải ảnh từ máy"></div></div><input type="file" class="file-input" onchange="handleFileInput(this)">
  </div>

  <div class="box note-box" data-id="review">
    <div class="trigger-top"><div class="trigger-bar trigger-image-link" onclick="promptImageUrl(this)" title="Nhập link ảnh"></div></div>
    <div class="trigger-right" onclick="promptAppUrl(this)" title="Nhúng ứng dụng/web"></div>
    <div class="box-title"><i class="fas fa-book-reader"></i> Ôn tập nhanh</div>
    <p>Nhắc lại khái niệm xác suất có điều kiện $P(A\mid B)$ và ý nghĩa “đã biết $B$ xảy ra”. Hãy lấy 1 ví dụ đời sống.</p>
    <div class="media-content-area">
      <img class="image-preview" alt="Xem trước"><div class="image-placeholder">Chưa có media trực quan...</div>
      <div class="embed-app-container"></div>
      <div class="audio-container"><div class="custom-audio-player"><div class="play-pause-btn"></div></div><div class="embed-audio-container"></div><audio></audio></div>
    </div>
    <div class="triggers-bottom"><div class="trigger-bar trigger-audio" onclick="promptAudio(this)"></div><div class="trigger-bar trigger-image-file" onclick="triggerFileInput(this)"></div></div><input type="file" class="file-input" onchange="handleFileInput(this)">
  </div>

  <div class="box activity-box" data-id="warmup">
    <div class="trigger-top"><div class="trigger-bar trigger-image-link" onclick="promptImageUrl(this)" title="Nhập link ảnh"></div></div>
    <div class="trigger-right" onclick="promptAppUrl(this)" title="Nhúng ứng dụng/web"></div>
    <div class="box-title"><i class="fas fa-laugh-beam"></i> Khởi động vui</div>
    <p>Tưởng tượng trộn một ly nước muối rất mặn với một xô nước muối rất nhạt. Vị cuối cùng sẽ gần với ly hay với xô hơn? Tại sao? (Gợi mở khái niệm <strong>trọng số</strong>.)</p>
    <div class="media-content-area">
      <img class="image-preview" alt="Xem trước"><div class="image-placeholder">Chưa có media trực quan...</div>
      <div class="embed-app-container"></div>
      <div class="audio-container"><div class="custom-audio-player"><div class="play-pause-btn"></div></div><div class="embed-audio-container"></div><audio></audio></div>
    </div>
    <div class="triggers-bottom"><div class="trigger-bar trigger-audio" onclick="promptAudio(this)"></div><div class="trigger-bar trigger-image-file" onclick="triggerFileInput(this)"></div></div><input type="file" class="file-input" onchange="handleFileInput(this)">
  </div>
  
  <div class="box note-box" data-id="vocab">
    <div class="trigger-top"><div class="trigger-bar trigger-image-link" onclick="promptImageUrl(this)" title="Nhập link ảnh"></div></div>
    <div class="trigger-right" onclick="promptAppUrl(this)" title="Nhúng ứng dụng/web"></div>
    <div class="box-title"><i class="fas fa-key"></i> Từ vựng & Ký hiệu</div>
    <ul>
      <li><span class="math-term"><strong>Phân hoạch (Partition):</strong></span> Một bộ các biến cố $B_1, \dots, B_n$ rời nhau từng đôi một và hợp của chúng bằng không gian mẫu $\Omega$.</li>
      <li><span class="math-term"><strong>Trọng số (Weight):</strong></span> Một số đo tầm quan trọng hoặc tần suất của một giá trị trong một tập hợp.</li>
    </ul>
    <div class="media-content-area">
      <img class="image-preview" alt="Xem trước"><div class="image-placeholder">Chưa có media trực quan...</div>
      <div class="embed-app-container"></div>
      <div class="audio-container"><div class="custom-audio-player"><div class="play-pause-btn"></div></div><div class="embed-audio-container"></div><audio></audio></div>
    </div>
    <div class="triggers-bottom"><div class="trigger-bar trigger-audio" onclick="promptAudio(this)"></div><div class="trigger-bar trigger-image-file" onclick="triggerFileInput(this)"></div></div><input type="file" class="file-input" onchange="handleFileInput(this)">
  </div>

  <div class="section-container"><h2>PHẦN 2: NỘI DUNG CỐT LÕI</h2></div>

  <div class="box example-box" data-id="weighted_def">
    <div class="trigger-top"><div class="trigger-bar trigger-image-link" onclick="promptImageUrl(this)" title="Nhập link ảnh"></div></div>
    <div class="trigger-right" onclick="promptAppUrl(this)" title="Nhúng ứng dụng/web"></div>
    <div class="box-title"><i class="fas fa-book-open"></i> Trung bình có trọng số</div>
    <p>Công thức: $ \overline{x} = \displaystyle\frac{\displaystyle\sum_{i=1}^{n}w_i x_i}{\displaystyle\sum_{i=1}^{n}w_i} $. Ở bài trộn dung dịch: $x_i$ là nồng độ, $w_i$ là thể tích.</p>
    <div class="media-content-area">
      <img class="image-preview" alt="Xem trước"><div class="image-placeholder">Chưa có media trực quan...</div>
      <div class="embed-app-container"></div>
      <div class="audio-container"><div class="custom-audio-player"><div class="play-pause-btn"></div></div><div class="embed-audio-container"></div><audio></audio></div>
    </div>
    <div class="triggers-bottom"><div class="trigger-bar trigger-audio" onclick="promptAudio(this)"></div><div class="trigger-bar trigger-image-file" onclick="triggerFileInput(this)"></div></div><input type="file" class="file-input" onchange="handleFileInput(this)">
  </div>
  
  <div class="box proof-box" data-id="mixing_example">
    <div class="trigger-top"><div class="trigger-bar trigger-image-link" onclick="promptImageUrl(this)"></div></div>
    <div class="trigger-right" onclick="promptAppUrl(this)"></div>
    <div class="box-title"><i class="fas fa-flask"></i> Ví dụ minh hoạ: Trộn hai bình nước muối</div>
    <p><strong>Bài toán.</strong> Bình 1: thể tích $m_1$, nồng độ $k_1$. Bình 2: thể tích $m_2$, nồng độ $k_2$. Nồng độ hỗn hợp là?</p>
    <p><strong>Lời giải (tĩnh):</strong> $$k=\displaystyle\frac{k_1m_1+k_2m_2}{m_1+m_2}.$$</p>
    <p><strong>Lời giải (động):</strong> Xem $w_1=\tfrac{m_1}{m_1+m_2}$, $w_2=\tfrac{m_2}{m_1+m_2}$ là trọng số, $$k=k_1w_1+k_2w_2.$$</p>
    <div class="media-content-area">
      <img class="image-preview" alt="Xem trước"><div class="image-placeholder">Chưa có media trực quan...</div>
      <div class="embed-app-container"></div>
      <div class="audio-container"><div class="custom-audio-player"><div class="play-pause-btn"></div></div><div class="embed-audio-container"></div><audio></audio></div>
    </div>
    <div class="triggers-bottom"><div class="trigger-bar trigger-audio" onclick="promptAudio(this)"></div><div class="trigger-bar trigger-image-file" onclick="triggerFileInput(this)"></div></div><input type="file" class="file-input" onchange="handleFileInput(this)">
  </div>
  
  <div class="box memo-box" data-id="ratio_to_prob">
    <div class="trigger-top"><div class="trigger-bar trigger-image-link" onclick="promptImageUrl(this)"></div></div>
    <div class="trigger-right" onclick="promptAppUrl(this)"></div>
    <div class="box-title"><i class="fas fa-link"></i> Bước nhảy: Từ tỷ lệ sang xác suất</div>
    <ul>
      <li>$k \Rightarrow P(\text{Đặc tính A})$.</li>
      <li>$k_1 \Rightarrow P(\text{A}\mid \text{Nhóm 1})$; $k_2 \Rightarrow P(\text{A}\mid \text{Nhóm 2})$.</li>
      <li>$\tfrac{m_1}{m_1+m_2} \Rightarrow P(\text{Nhóm 1})$; $\tfrac{m_2}{m_1+m_2} \Rightarrow P(\text{Nhóm 2})$.</li>
    </ul>
    <p>Thay các đại lượng vào công thức trung bình có trọng số sẽ ra công thức xác suất toàn phần.</p>
    <div class="media-content-area">
      <img class="image-preview" alt="Xem trước"><div class="image-placeholder">Chưa có media trực quan...</div>
      <div class="embed-app-container"></div>
      <div class="audio-container"><div class="custom-audio-player"><div class="play-pause-btn"></div></div><div class="embed-audio-container"></div><audio></audio></div>
    </div>
    <div class="triggers-bottom"><div class="trigger-bar trigger-audio" onclick="promptAudio(this)"></div><div class="trigger-bar trigger-image-file" onclick="triggerFileInput(this)"></div></div><input type="file" class="file-input" onchange="handleFileInput(this)">
  </div>

  <div class="box example-box" data-id="total_prob_theorem">
    <div class="trigger-top"><div class="trigger-bar trigger-image-link" onclick="promptImageUrl(this)"></div></div>
    <div class="trigger-right" onclick="promptAppUrl(this)"></div>
    <div class="box-title"><i class="fas fa-superscript"></i> Công thức xác suất toàn phần</div>
    <p>Tổng quát cho phân hoạch $B_1,\dots,B_n$: $$P(A)=\sum_{k=1}^n P(A\mid B_k)\,P(B_k).$$</p>
    <div class="media-content-area">
      <img class="image-preview" alt="Xem trước"><div class="image-placeholder">Chưa có media trực quan...</div>
      <div class="embed-app-container"></div>
      <div class="audio-container"><div class="custom-audio-player"><div class="play-pause-btn"></div></div><div class="embed-audio-container"></div><audio></audio></div>
    </div>
    <div class="triggers-bottom"><div class="trigger-bar trigger-audio" onclick="promptAudio(this)"></div><div class="trigger-bar trigger-image-file" onclick="triggerFileInput(this)"></div></div><input type="file" class="file-input" onchange="handleFileInput(this)">
  </div>

  <div class="box proof-box" data-id="math_story">
      <div class="trigger-top"><div class="trigger-bar trigger-image-link" onclick="promptImageUrl(this)" title="Nhập link ảnh"></div></div>
      <div class="trigger-right" onclick="promptAppUrl(this)" title="Nhúng ứng dụng/web"></div>
      <div class="box-title"><i class="fas fa-scroll"></i> Góc nhìn Lịch sử</div>
      <p>Công thức này là nền tảng cho Suy luận Bayes, một nhánh cực kỳ quan trọng của thống kê hiện đại, được dùng trong AI, y học và tài chính, phát triển bởi Thomas Bayes và Pierre-Simon Laplace.</p>
      <div class="media-content-area">
        <img class="image-preview" alt="Xem trước"><div class="image-placeholder">Chưa có media trực quan...</div>
        <div class="embed-app-container"></div>
        <div class="audio-container"><div class="custom-audio-player"><div class="play-pause-btn"></div></div><div class="embed-audio-container"></div><audio></audio></div>
      </div>
      <div class="triggers-bottom"><div class="trigger-bar trigger-audio" onclick="promptAudio(this)"></div><div class="trigger-bar trigger-image-file" onclick="triggerFileInput(this)"></div></div><input type="file" class="file-input" onchange="handleFileInput(this)">
  </div>

  <div class="section-container"><h2>PHẦN 3: LUYỆN TẬP & VẬN DỤNG</h2></div>

  <div class="box activity-box" data-id="group_activity">
    <div class="trigger-top"><div class="trigger-bar trigger-image-link" onclick="promptImageUrl(this)"></div></div>
    <div class="trigger-right" onclick="promptAppUrl(this)"></div>
    <div class="box-title"><i class="fas fa-users"></i> Hoạt động nhóm</div>
    <p>Hãy nghĩ ra một kịch bản đời thực dùng trung bình có trọng số (điểm trung bình, giá vốn cổ phiếu, trộn nhiệt độ...). Trình bày vì sao <em>trọng số</em> quyết định kết quả.</p>
    <div class="media-content-area">
      <img class="image-preview" alt="Xem trước"><div class="image-placeholder">Chưa có media trực quan...</div>
      <div class="embed-app-container"></div>
      <div class="audio-container"><div class="custom-audio-player"><div class="play-pause-btn"></div></div><div class="embed-audio-container"></div><audio></audio></div>
    </div>
    <div class="triggers-bottom"><div class="trigger-bar trigger-audio" onclick="promptAudio(this)"></div><div class="trigger-bar trigger-image-file" onclick="triggerFileInput(this)"></div></div><input type="file" class="file-input" onchange="handleFileInput(this)">
  </div>

  <div class="box exercise-box" data-id="real_world">
    <div class="trigger-top"><div class="trigger-bar trigger-image-link" onclick="promptImageUrl(this)"></div></div>
    <div class="trigger-right" onclick="promptAppUrl(this)"></div>
    <div class="box-title"><i class="fas fa-globe-asia"></i> Thử thách thực tế</div>
    <p>Một nhà máy có hai dây chuyền. A sản xuất $60\%$ tổng sản lượng với tỉ lệ lỗi $1\%$. B sản xuất $40\%$ với tỉ lệ lỗi $3\%$. Chọn ngẫu nhiên 1 sản phẩm. Tính xác suất sản phẩm lỗi.</p>
    <div class="media-content-area">
      <img class="image-preview" alt="Xem trước"><div class="image-placeholder">(Có thể thêm sơ đồ cây xác suất hoặc ảnh minh hoạ.)</div>
      <div class="embed-app-container"></div>
      <div class="audio-container"><div class="custom-audio-player"><div class="play-pause-btn"></div></div><div class="embed-audio-container"></div><audio></audio></div>
    </div>
    <div class="triggers-bottom"><div class="trigger-bar trigger-audio" onclick="promptAudio(this)"></div><div class="trigger-bar trigger-image-file" onclick="triggerFileInput(this)"></div></div><input type="file" class="file-input" onchange="handleFileInput(this)">
  </div>

  <div class="box exercise-box" data-id="quick_quiz">
      <div class="trigger-top"><div class="trigger-bar trigger-image-link" onclick="promptImageUrl(this)" title="Nhập link ảnh"></div></div>
      <div class="trigger-right" onclick="promptAppUrl(this)" title="Nhúng ứng dụng/web"></div>
      <div class="box-title"><i class="fas fa-question-circle"></i> Trắc nghiệm nhanh</div>
      <p><strong>Câu hỏi:</strong> Khi nào thì trung bình có trọng số của hai giá trị $x_1, x_2$ bằng với trung bình cộng $\displaystyle\frac{x_1+x_2}{2}$?</p>
      <ol type="A">
        <li>Khi $x_1 = x_2$</li>
        <li>Khi trọng số $w_1 = w_2$</li>
        <li>Cả A và B đều đúng</li>
      </ol>
      <div class="media-content-area">
        <img class="image-preview" alt="Xem trước"><div class="image-placeholder">Chưa có media trực quan...</div>
        <div class="embed-app-container"></div>
        <div class="audio-container"><div class="custom-audio-player"><div class="play-pause-btn"></div></div><div class="embed-audio-container"></div><audio></audio></div>
      </div>
      <div class="triggers-bottom"><div class="trigger-bar trigger-audio" onclick="promptAudio(this)"></div><div class="trigger-bar trigger-image-file" onclick="triggerFileInput(this)"></div></div><input type="file" class="file-input" onchange="handleFileInput(this)">
  </div>
  
  <div class="box activity-box" data-id="common_mistakes">
      <div class="trigger-top"><div class="trigger-bar trigger-image-link" onclick="promptImageUrl(this)" title="Nhập link ảnh"></div></div>
      <div class="trigger-right" onclick="promptAppUrl(this)"></div>
      <div class="box-title"><i class="fas fa-exclamation-triangle"></i> Sai lầm thường gặp</div>
      <ul>
          <li><strong>Nhầm lẫn trọng số:</strong> Dùng $k = \displaystyle\frac{k_1+k_2}{2}$ thay vì tính theo trọng số. Điều này chỉ đúng khi $m_1=m_2$.</li>
          <li><strong>Quên điều kiện phân hoạch:</strong> Áp dụng công thức xác suất toàn phần khi các biến cố $B_k$ không phải là một phân hoạch.</li>
      </ul>
      <div class="media-content-area">
        <img class="image-preview" alt="Xem trước"><div class="image-placeholder">Chưa có media trực quan...</div>
        <div class="embed-app-container"></div>
        <div class="audio-container"><div class="custom-audio-player"><div class="play-pause-btn"></div></div><div class="embed-audio-container"></div><audio></audio></div>
      </div>
      <div class="triggers-bottom"><div class="trigger-bar trigger-audio" onclick="promptAudio(this)"></div><div class="trigger-bar trigger-image-file" onclick="triggerFileInput(this)"></div></div><input type="file" class="file-input" onchange="handleFileInput(this)">
  </div>

  <div class="box exercise-box" data-id="self_practice">
    <div class="trigger-top"><div class="trigger-bar trigger-image-link" onclick="promptImageUrl(this)"></div></div>
    <div class="trigger-right" onclick="promptAppUrl(this)"></div>
    <div class="box-title"><i class="fas fa-puzzle-piece"></i> Bài tập tự luyện</div>
    <ol>
      <li>Trộn $2$ lít dung dịch muối $15\%$ với $8$ lít dung dịch $5\%$. Tính nồng độ hỗn hợp.</li>
      <li>Mở rộng cho ba bình: viết công thức nồng độ $k$ theo $m_1,k_1,m_2,k_2,m_3,k_3$.</li>
    </ol>
    <div class="media-content-area">
      <img class="image-preview" alt="Xem trước"><div class="image-placeholder">Chưa có media trực quan...</div>
      <div class="embed-app-container"></div>
      <div class="audio-container"><div class="custom-audio-player"><div class="play-pause-btn"></div></div><div class="embed-audio-container"></div><audio></audio></div>
    </div>
    <div class="triggers-bottom"><div class="trigger-bar trigger-audio" onclick="promptAudio(this)"></div><div class="trigger-bar trigger-image-file" onclick="triggerFileInput(this)"></div></div><input type="file" class="file-input" onchange="handleFileInput(this)">
  </div>

  <div class="box proof-box" data-id="answers">
    <div class="trigger-top"><div class="trigger-bar trigger-image-link" onclick="promptImageUrl(this)"></div></div>
    <div class="trigger-right" onclick="promptAppUrl(this)"></div>
    <div class="box-title"><i class="fas fa-check"></i> Gợi ý/Đáp án</div>
    <ol>
      <li>$k=15\%\cdot\tfrac{2}{10}+5\%\cdot\tfrac{8}{10}=3\%+4\%=7\%$.</li>
      <li>$k=\displaystyle\frac{k_1m_1+k_2m_2+k_3m_3}{m_1+m_2+m_3}$.</li>
    </ol>
    <div class="media-content-area">
      <img class="image-preview" alt="Xem trước"><div class="image-placeholder">Chưa có media trực quan...</div>
      <div class="embed-app-container"></div>
      <div class="audio-container"><div class="custom-audio-player"><div class="play-pause-btn"></div></div><div class="embed-audio-container"></div><audio></audio></div>
    </div>
    <div class="triggers-bottom"><div class="trigger-bar trigger-audio" onclick="promptAudio(this)"></div><div class="trigger-bar trigger-image-file" onclick="triggerFileInput(this)"></div></div><input type="file" class="file-input" onchange="handleFileInput(this)">
  </div>

  <div class="section-container"><h2>PHẦN 4: TỔNG KẾT & MỞ RỘNG</h2></div>

  <div class="box memo-box" data-id="summary">
    <div class="trigger-top"><div class="trigger-bar trigger-image-link" onclick="promptImageUrl(this)"></div></div>
    <div class="trigger-right" onclick="promptAppUrl(this)"></div>
    <div class="box-title"><i class="fas fa-clipboard-list"></i> Tổng kết</div>
    <ul>
      <li>Trọng số phản ánh mức ảnh hưởng của từng trường hợp.</li>
      <li>$P(A)=\displaystyle\sum_k P(A\mid B_k)P(B_k)$ là “trung bình có trọng số” trong thế giới xác suất.</li>
    </ul>
    <div class="media-content-area">
      <img class="image-preview" alt="Xem trước"><div class="image-placeholder">Chưa có media trực quan...</div>
      <div class="embed-app-container"></div>
      <div class="audio-container"><div class="custom-audio-player"><div class="play-pause-btn"></div></div><div class="embed-audio-container"></div><audio></audio></div>
    </div>
    <div class="triggers-bottom"><div class="trigger-bar trigger-audio" onclick="promptAudio(this)"></div><div class="trigger-bar trigger-image-file" onclick="triggerFileInput(this)"></div></div><input type="file" class="file-input" onchange="handleFileInput(this)">
  </div>

  <div class="box note-box" data-id="extension">
    <div class="trigger-top"><div class="trigger-bar trigger-image-link" onclick="promptImageUrl(this)"></div></div>
    <div class="trigger-right" onclick="promptAppUrl(this)"></div>
    <div class="box-title"><i class="fas fa-rocket"></i> Mở rộng & Liên hệ</div>
    <p>Liên hệ với <strong>kỳ vọng</strong> của biến ngẫu nhiên rời rạc: $\mathbb{E}[X]=\displaystyle\sum_x x\,P(X=x)$ — cũng là một trung bình có trọng số bằng xác suất.</p>
    <div class="media-content-area">
      <img class="image-preview" alt="Xem trước"><div class="image-placeholder">Chưa có media trực quan...</div>
      <div class="embed-app-container"></div>
      <div class="audio-container"><div class="custom-audio-player"><div class="play-pause-btn"></div></div><div class="embed-audio-container"></div><audio></audio></div>
    </div>
    <div class="triggers-bottom"><div class="trigger-bar trigger-audio" onclick="promptAudio(this)"></div><div class="trigger-bar trigger-image-file" onclick="triggerFileInput(this)"></div></div><input type="file" class="file-input" onchange="handleFileInput(this)">
  </div>

  <div class="box note-box" data-id="homework">
    <div class="trigger-top"><div class="trigger-bar trigger-image-link" onclick="promptImageUrl(this)"></div></div>
    <div class="trigger-right" onclick="promptAppUrl(this)"></div>
    <div class="box-title"><i class="fas fa-pen-fancy"></i> Dặn dò</div>
    <p>Làm các bài 1, 3, 5 trong SGK trang 52. Đọc trước bài “Biến ngẫu nhiên và phân phối xác suất”.</p>
    <div class="media-content-area">
      <img class="image-preview" alt="Xem trước"><div class="image-placeholder">Chưa có media trực quan...</div>
      <div class="embed-app-container"></div>
      <div class="audio-container"><div class="custom-audio-player"><div class="play-pause-btn"></div></div><div class="embed-audio-container"></div><audio></audio></div>
    </div>
    <div class="triggers-bottom"><div class="trigger-bar trigger-audio" onclick="promptAudio(this)"></div><div class="trigger-bar trigger-image-file" onclick="triggerFileInput(this)"></div></div><input type="file" class="file-input" onchange="handleFileInput(this)">
  </div>
</div>

<script>
  function getMediaElements(triggerElement) {
    const box = triggerElement.closest('.box'); if (!box) return null;
    return {
      id: box.dataset.id, box: box,
      preview: box.querySelector('.image-preview'), placeholder: box.querySelector('.image-placeholder'),
      audioContainer: box.querySelector('.audio-container'), customPlayer: box.querySelector('.custom-audio-player'),
      embedAudioContainer: box.querySelector('.audio-container .embed-audio-container'), audioPlayer: box.querySelector('audio'),
      playBtn: box.querySelector('.play-pause-btn'), fileInput: box.querySelector('.file-input'),
      appContainer: box.querySelector('.embed-app-container'),
    };
  }
  function updatePlaceholderVisibility(elements) {
    if (!elements || !elements.placeholder) return;
    const imageVisible = elements.preview && elements.preview.style.display === 'block';
    const appVisible = elements.appContainer && elements.appContainer.style.display === 'block';
    elements.placeholder.style.display = (imageVisible || appVisible) ? 'none' : 'flex';
  }
  function showImage(elements, src) { if (!elements) return; elements.preview.src = src; elements.preview.style.display = 'block'; updatePlaceholderVisibility(elements); }
  function promptImageUrl(trigger) { const url = prompt('Nhập link ảnh (URL):'); const elements = getMediaElements(trigger); if (url && elements) { localStorage.setItem(`mediaImage_${elements.id}`, url); showImage(elements, url); } }
  function handleFileInput(input) { const file = input.files[0]; const elements = getMediaElements(input); if (file && elements) { const reader = new FileReader(); reader.onload = (e) => { localStorage.setItem(`mediaImage_${elements.id}`, e.target.result); showImage(elements, e.target.result); }; reader.readAsDataURL(file); } }
  function triggerFileInput(trigger) { const elements = getMediaElements(trigger); if (elements && elements.fileInput) { elements.fileInput.click(); } }
  function showAudio(elements, audioData) {
    if (!elements) return; elements.customPlayer.style.display = 'none'; elements.embedAudioContainer.style.display = 'none'; elements.embedAudioContainer.innerHTML = ''; elements.audioPlayer.src = '';
    if (audioData.trim().startsWith('<')) { // embed code
      const cleaned = audioData.replace(/<br.*?>\s*<a.*?voca\.ro.*?<\/a>/i, '');
      elements.embedAudioContainer.innerHTML = cleaned; elements.embedAudioContainer.style.display = 'block';
    } else {
      elements.audioPlayer.src = audioData; elements.customPlayer.style.display = 'flex';
    }
  }
  function promptAudio(trigger) { const input = prompt('Nhập link âm thanh (.mp3) hoặc mã nhúng:'); const elements = getMediaElements(trigger); if (input && input.trim() !== '' && elements) { localStorage.setItem(`mediaAudio_${elements.id}`, input); showAudio(elements, input); } }
  function setupCustomAudioPlayer(elements) { if (!elements || elements.box.dataset.playerSetup === 'true') return; const togglePlay = () => { if (elements.audioPlayer.paused) elements.audioPlayer.play(); else elements.audioPlayer.pause(); }; elements.customPlayer?.addEventListener('click', togglePlay); elements.audioPlayer?.addEventListener('play', () => elements.playBtn?.classList.add('playing')); elements.audioPlayer?.addEventListener('pause', () => elements.playBtn?.classList.remove('playing')); elements.audioPlayer?.addEventListener('ended', () => elements.playBtn?.classList.remove('playing')); elements.box.dataset.playerSetup = 'true'; }
  function showApp(elements, url) { if (!elements) return; elements.appContainer.innerHTML = `<iframe src="${url}"></iframe>`; elements.appContainer.style.display = 'block'; updatePlaceholderVisibility(elements); }
  function promptAppUrl(trigger) { const url = prompt('Nhập link của ứng dụng hoặc trang web để nhúng:'); const elements = getMediaElements(trigger); if (url && elements) { localStorage.setItem(`mediaApp_${elements.id}`, url); showApp(elements, url); } }
  document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('.box[data-id]').forEach((box) => {
      const elements = getMediaElements(box); if (!elements) return;
      const imgData = localStorage.getItem(`mediaImage_${elements.id}`); if (imgData) showImage(elements, imgData);
      const audioData = localStorage.getItem(`mediaAudio_${elements.id}`); if (audioData) showAudio(elements, audioData);
      const appData = localStorage.getItem(`mediaApp_${elements.id}`); if (appData) showApp(elements, appData);
      const mediaContentArea = box.querySelector('.media-content-area');
      if (mediaContentArea && (!imgData && !appData && !audioData)) {
        // do nothing
      } else { if (mediaContentArea) updatePlaceholderVisibility(elements); }
      setupCustomAudioPlayer(elements);
    });
  });
</script>

</body>
</html>